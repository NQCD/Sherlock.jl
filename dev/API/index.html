<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API · ClusterScripts</title><meta name="title" content="API · ClusterScripts"/><meta property="og:title" content="API · ClusterScripts"/><meta property="twitter:title" content="API · ClusterScripts"/><meta name="description" content="Documentation for ClusterScripts."/><meta property="og:description" content="Documentation for ClusterScripts."/><meta property="twitter:description" content="Documentation for ClusterScripts."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClusterScripts</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/NQCD/ClusterScripts.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/NQCD/ClusterScripts.jl/blob/main/docs/src/API.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="ClusterScripts.jl-API"><a class="docs-heading-anchor" href="#ClusterScripts.jl-API">ClusterScripts.jl API</a><a id="ClusterScripts.jl-API-1"></a><a class="docs-heading-anchor-permalink" href="#ClusterScripts.jl-API" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClusterScripts.ResultsLazyLoader" href="#ClusterScripts.ResultsLazyLoader"><code>ClusterScripts.ResultsLazyLoader</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Struct to view into results files, loading full results only if directly accessed.</p><p>If parameters or derived<em>quantities are modified, remember to call <code>save!()</code> to update the file. Modifications to results outside those made by `concatenate</em>results!` will not be saved.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/ClusterScripts.jl/blob/992dbe783acaaa4a4ba20162ae393ae1398b61b1/src/ClusterScripts.jl#L28-L33">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClusterScripts.SimulationFile" href="#ClusterScripts.SimulationFile"><code>ClusterScripts.SimulationFile</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Struct to hold file paths and provide some basic functionality for working with them.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/ClusterScripts.jl/blob/992dbe783acaaa4a4ba20162ae393ae1398b61b1/src/ClusterScripts.jl#L11-L13">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.setindex!-Tuple{ResultsLazyLoader, Any, Int64}" href="#Base.setindex!-Tuple{ResultsLazyLoader, Any, Int64}"><code>Base.setindex!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">Base.setindex!(loader::ResultsLazyLoader, val, i::Int)</code></pre><p><strong>Warning: This overwrites the entire results group!</strong> use <code>loader[i]=append!(deepcopy(loader[i]), X)</code> or similar to append to existing data.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/ClusterScripts.jl/blob/992dbe783acaaa4a4ba20162ae393ae1398b61b1/src/file_based.jl#L43-L48">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClusterScripts.build_job_queue-Tuple{Dict, Dict, Function}" href="#ClusterScripts.build_job_queue-Tuple{Dict, Dict, Function}"><code>ClusterScripts.build_job_queue</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">build_job_queue(fixed_parameters::Dict, variables::Dict, postprocessing_function::Function)</code></pre><p>Returns a Vector of all unique combinations of values in <code>variables</code> merged with <code>fixed_parameters</code>. By specifying a <code>postprocessing_function</code>, further actions can be performed each of the elements in the resulting vector.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/ClusterScripts.jl/blob/992dbe783acaaa4a4ba20162ae393ae1398b61b1/src/file_based.jl#L204-L209">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClusterScripts.build_job_queue-Tuple{Dict, Dict}" href="#ClusterScripts.build_job_queue-Tuple{Dict, Dict}"><code>ClusterScripts.build_job_queue</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">build_job_queue(fixed_parameters::Dict, variables::Dict)</code></pre><p>Returns a Vector of all unique combinations of values in <code>variables</code> merged with <code>fixed_parameters</code>. Each key in <code>variables</code> should be a list of possible values for that parameter. (Trivially, a length 1 list)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/ClusterScripts.jl/blob/992dbe783acaaa4a4ba20162ae393ae1398b61b1/src/file_based.jl#L189-L194">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClusterScripts.convert_to_grouped_jld2-Tuple{Any, Any, Any}" href="#ClusterScripts.convert_to_grouped_jld2-Tuple{Any, Any, Any}"><code>ClusterScripts.convert_to_grouped_jld2</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">convert_to_grouped_jld2(filename, results_data, simulation_queue; trajectories_key = &quot;trajectories&quot;)</code></pre><p>Converts the results format of an ungrouped JLD2 file to the grouped format and adds the simulation parameters from a simulation queue.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/ClusterScripts.jl/blob/992dbe783acaaa4a4ba20162ae393ae1398b61b1/src/file_based.jl#L92-L96">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClusterScripts.convert_to_grouped_jld2-Tuple{Any, Any}" href="#ClusterScripts.convert_to_grouped_jld2-Tuple{Any, Any}"><code>ClusterScripts.convert_to_grouped_jld2</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">convert_to_grouped_jld2(filename, results_data)</code></pre><p>Converts the results format of an ungrouped JLD2 file to the grouped format. <strong>Warning: This method yields undefined simulation parameters which normally shouldn&#39;t occur in grouped JLD2 files.</strong></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/ClusterScripts.jl/blob/992dbe783acaaa4a4ba20162ae393ae1398b61b1/src/file_based.jl#L68-L73">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClusterScripts.create_results_file-Tuple{String, String, String}" href="#ClusterScripts.create_results_file-Tuple{String, String, String}"><code>ClusterScripts.create_results_file</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">create_results_file(output_filename::String, glob_pattern::String, queue_file::String;trajectories_key=&quot;trajectories&quot;, truncate_times=true)</code></pre><p>Compresses all results from a simulation queue back into a single file. Any missing outputs are reported as warnings and will be undefined in the final output.</p><p>This file contains the results of all jobs in the queue, as well as the input parameters for each job in the following format:</p><ul><li><code>file[&quot;results&quot;]</code> contains an Array with the same dimensions as the input parameters.</li><li>Each element of <code>file[&quot;results&quot;]</code> contains a tuple of the output from the simulation and the input parameters for that simulation.</li><li>Simulation output will always be a vector, even for single trajectories, to allow for consistent analysis functions that are independent of trajectory numbers.</li></ul><p><strong>Arguments</strong> <code>output_filename::String</code>: The name of the file to save the results to.</p><p><code>glob_pattern::String</code>: A glob pattern to match all files to merge.</p><p><code>queue_file::String</code>: The file containing the input parameters for the simulation queue.</p><p><code>trajectories_key::String</code>: The key in the input parameters dictionary which describes batching behaviour. (typically &quot;trajectories&quot;, since we want to farm out trajectories to workers)</p><p><code>truncate_times::Bool</code>: If true, the time array in the output will be truncated to the final value only. Useful to save space when a large number of identical trajectories are run with short time steps.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/ClusterScripts.jl/blob/992dbe783acaaa4a4ba20162ae393ae1398b61b1/src/file_based.jl#L122-L144">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClusterScripts.merge_pmap_results-Tuple{AbstractArray}" href="#ClusterScripts.merge_pmap_results-Tuple{AbstractArray}"><code>ClusterScripts.merge_pmap_results</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">merge_pmap_results(simulation_output;trajectories_key=&quot;trajectories&quot;, ensemble_key=&quot;ensemble_algorithm&quot;)
Merger function for NQCD simulation results. Takes a vector of (NQCD output, input_parameters) tuples and merges together all unique combinations of simulation parameters, adding the number of trajectories together as if the simulation was run as a larger ensemble.</code></pre><p>TBW</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/ClusterScripts.jl/blob/992dbe783acaaa4a4ba20162ae393ae1398b61b1/src/pmap.jl#L92-L96">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClusterScripts.pmap_queue-Tuple{Any, Vector{Dict}}" href="#ClusterScripts.pmap_queue-Tuple{Any, Vector{Dict}}"><code>ClusterScripts.pmap_queue</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">pmap_queue(target_function::Function, input_list::Vector{Dict}; trajectories_key=&quot;trajectories&quot;, ensemble_key=&quot;ensemble_algorithm&quot;, tmp_dir=&quot;tmp/&quot;, checkpoint_frequency=0, sort_variable=&quot;&quot;)
Splits a list of input parameters into smaller operations for better multiprocessing, then runs the target function on the list of inputs and merges the results back together again.

Arguments similar to pmap: loadbalance_queue(f, args)

`trajectories_key`: Dictionary key in input parameter dictionary holding the number of trajectories for target_function to perform.

`ensemble_key`: Dictionary key in input parameters containing the EnsembleAlgorithm for NQCD to use.

`tmp_dir`: Location for checkpoint files.

`checkpoint_frequency`: Number of operations per worker to perform before saving to a tempfile. (Default is 1 per worker - the faster and more stable, the higher to go)

`sort_variable`: Offers the option to sort all jobs generated by a certain input parameter to group tasks of similar size together.</code></pre><p>TBW</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/ClusterScripts.jl/blob/992dbe783acaaa4a4ba20162ae393ae1398b61b1/src/pmap.jl#L1-L17">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClusterScripts.push_nqcd_outputs!-Tuple{Any, Any}" href="#ClusterScripts.push_nqcd_outputs!-Tuple{Any, Any}"><code>ClusterScripts.push_nqcd_outputs!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">push_nqcd_outputs!!(first_output, other_outputs...)

Like a push!() function, but it also puts `first_output` into a vector if it wasn&#39;t already and adds the number of trajectories together.</code></pre><p>TBW</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/ClusterScripts.jl/blob/992dbe783acaaa4a4ba20162ae393ae1398b61b1/src/concat_output.jl#L89-L94">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClusterScripts.save!-Tuple{ResultsLazyLoader}" href="#ClusterScripts.save!-Tuple{ResultsLazyLoader}"><code>ClusterScripts.save!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">save!(loader::ResultsLazyLoader)</code></pre><p>Updates the stored parameters and derived quantities inside a grouped JLD2 file. Run this function after modifying <code>loader.parameters</code> or <code>loader.derived_quantities</code> to save the changes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/ClusterScripts.jl/blob/992dbe783acaaa4a4ba20162ae393ae1398b61b1/src/file_based.jl#L4-L9">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClusterScripts.serialise_queue!-Tuple{Vector{&lt;:Dict}}" href="#ClusterScripts.serialise_queue!-Tuple{Vector{&lt;:Dict}}"><code>ClusterScripts.serialise_queue!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">serialise_queue!(input_dict_tensor::Vector{&lt;: Dict{&lt;: Any}}; trajectories_key=&quot;trajectories&quot;, filename=&quot;simulation_parameters.jld2&quot;)</code></pre><p>Performs batching on the Array of input parameters for multithreading/multiprocessing. By assigning the key &quot;batchsize&quot; in the input parameters, each simulation job will be split into as many batches as necessary to run the required number of trajectories. The default batch size is 1, i.e. trivial taskfarming.</p><p>Set &quot;trajectories_key&quot; in case jobs should be split by something different.</p><p>Set &quot;filename&quot; to save the resulting batch queue somewhere different than <code>simulation_parameters.jld2</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/ClusterScripts.jl/blob/992dbe783acaaa4a4ba20162ae393ae1398b61b1/src/file_based.jl#L220-L230">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClusterScripts.update_results_file-NTuple{4, String}" href="#ClusterScripts.update_results_file-NTuple{4, String}"><code>ClusterScripts.update_results_file</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">update_results_file(input_file::String, glob_pattern::String, queue_file::String, output_file::String; trajectories_key=&quot;trajectories&quot;, file_format::String=&quot;jld2&quot;)</code></pre><p>Merges existing results from an <strong>ungrouped JLD2 file</strong> into a new <strong>ungrouped JLD2 file</strong>.</p><p><strong>Arguments</strong> <code>output_filename::String</code>: The name of the file to save the results to.</p><p><code>glob_pattern::String</code>: A glob pattern to match all files to merge.</p><p><code>queue_file::String</code>: The file containing the input parameters for the simulation queue.</p><p><code>trajectories_key::String</code>: The key in the input parameters dictionary which describes batching behaviour. (typically &quot;trajectories&quot;, since we want to farm out trajectories to workers)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/NQCD/ClusterScripts.jl/blob/992dbe783acaaa4a4ba20162ae393ae1398b61b1/src/file_based.jl#L158-L173">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Tuesday 14 May 2024 13:06">Tuesday 14 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
